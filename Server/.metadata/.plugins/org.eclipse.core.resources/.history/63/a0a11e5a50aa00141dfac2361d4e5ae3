package evans.dave.AndrotagServer;

import java.io.*; 
import java.net.*; 
import java.util.ArrayList;

import evans.dave.AndrotagCommon.TCPMessage;
import evans.dave.duinotag.*;

class TCPClient {  
	public static void main(String argv[]) throws Exception {   
		String sentence;   
		String modifiedSentence;
		ArrayList<GameInfo> gameList = new ArrayList<>();
		BufferedReader inFromUser = new BufferedReader( new InputStreamReader(System.in));   
		Socket clientSocket = new Socket("localhost", 7000);   
		DataOutputStream outToServer = new DataOutputStream(clientSocket.getOutputStream());   
		ObjectInputStream inFromServer = new ObjectInputStream(clientSocket.getInputStream());   
		while (true){
			sentence = inFromUser.readLine();   
			int code = (int) sentence.charAt(0) - (int)'0';
			sentence = sentence.substring(1);
			
			if (code == TCPMessage.STRING_MSG){
				outToServer.writeInt(code);
				outToServer.writeBytes(sentence + '\n'); 
			} else if (code == TCPMessage.GET_GAMES){
				outToServer.writeInt(code);
				code = inFromServer.read();
				if (code != TCPMessage.GET_GAMES){
					System.out.println("Unexpected code from server");
				} else {
					int n = inFromServer.read();
					gameList.clear();
					for (int i = 0; i<n; i++){
						GameInfo g = (GameInfo) inFromServer.readObject();
						long startTime = (g.startTime-System.currentTimeMillis())/60000;
						gameList.add(g);
						System.out.printf("%d\t %d\t %s\n",g.id, startTime, g.creator.name);
					}
					
				}
			}
		}
		//clientSocket.close();  
	} 
} 